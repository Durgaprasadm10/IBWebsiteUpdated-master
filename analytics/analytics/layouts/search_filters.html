<?php
/******************************************************************
 * Ideabytes Software India Pvt Ltd.                              *
 * 50 Jayabheri Enclave, Gachibowli, HYD                          *
 * Created Date : 13/08/2014                                      *
 * Created By : Sri Ravi Teja                                     *
 * Vision : Project Visitortracking MVC                           *  
 * Modified by : Sri Ravi Teja  Date : 14/08/2014   Version : 2.0 *
 * Description : search filters for analytics_byfilter page       *
 *****************************************************************/
?>
<div id="wrapper">
            <div id="content">
       			<div id="rightnow">
                    <h3 class="reallynow">
					<?php     
						if($count > 0)
						{
							echo '<span>
							<form name="searchby"  method="post">
								<a href="" class="report" value="Export to EXCEL" onclick= "return makepdf()">Report</a>
								<a href="" class="report_seo" value="Export to PDF" onclick="return exportExcel()">Report</a>';
									$searhCond = "";
									@$cn = $_POST['country_name'];
									@$cyn = $_POST['city_name'];
									@$Ip = $_POST['IpAddress'];
									@$pid = $_POST['page_id'];
									@$pdate = $_POST['date'];
									@$ptodate = $_POST['todate'];
									@$pfromdate = $_POST['fromdate'];
									
									echo '<input type="hidden" name="cn" id="cn" value="'.$cn.'">';
									echo '<input type="hidden" name="cyn" id="cyn" value="'.$cyn.'">';
									echo '<input type="hidden" name="Ip" id="Ip" value="'.$Ip.'">';
									echo '<input type="hidden" name="pid" id="pid" value="'.$pid.'">';
									echo '<input type="hidden" name="pdate" id="pdate" value="'.$pdate.'">';
									echo '<input type="hidden" name="ptodate" id="ptodate" value="'.$ptodate.'">';
									echo '<input type="hidden" name="pfromdate" id="pfromdate" value="'.$pfromdate.'">';
							echo '</form>
							</span>';
						}
						?>
						<form name="f_timezone" action="" style="float:right;margin-top:-9px;">    
							<select style="" name="timezone" id="DropDownTimezone1" onchange="this.form.submit();">
								<option value="-12.0"<?php echo (@$coockie == "-12:00") ? "selected" : ""; ?>>(GMT -12:00) Eniwetok, Kwajalein</option>
								<option value="-11.0"<?php echo (@$coockie == "-11:00") ? "selected" : ""; ?>>(GMT -11:00) Midway Island, Samoa</option>
								<option value="-10.0"<?php echo (@$coockie == "-10:00") ? "selected" : ""; ?>>(GMT -10:00) Hawaii</option>
								<option value="-9.0"<?php echo (@$coockie == "-09:00") ? "selected" : ""; ?>>(GMT -9:00) Alaska</option>
								<option value="-8.0"<?php echo (@$coockie == "-08:00") ? "selected" : ""; ?>>(GMT -8:00) Pacific Time (US &amp; Canada)</option>
								<option value="-7.0"<?php echo (@$coockie == "-07:00") ? "selected" : ""; ?>>(GMT -7:00) Mountain Time (US &amp; Canada)</option>
								<option value="-6.0"<?php echo (@$coockie == "-06:00") ? "selected" : ""; ?>>(GMT -6:00) Central Time (US &amp; Canada), Mexico City</option>
								<option value="-5.0"<?php echo (@$coockie == "-05:00") ? "selected" : ""; ?>>(GMT -5:00) Eastern Time (US &amp; Canada), Bogota, Lima</option>
								<option value="-4.0"<?php echo (@$coockie == "-04:00") ? "selected" : ""; ?>>(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz</option>
								<option value="-3.5"<?php echo (@$coockie == "-03:30") ? "selected" : ""; ?>>(GMT -3:30) Newfoundland</option>
								<option value="-3.0"<?php echo (@$coockie == "-03:00") ? "selected" : ""; ?>>(GMT -3:00) Brazil, Buenos Aires, Georgetown</option>
								<option value="-2.0"<?php echo (@$coockie == "-02:00") ? "selected" : ""; ?>>(GMT -2:00) Mid-Atlantic</option>
								<option value="-1.0"<?php echo (@$coockie == "-01:00") ? "selected" : ""; ?>>(GMT -1:00 hour) Azores, Cape Verde Islands</option>
								<option value="0.0"<?php echo (@$coockie == "+00:00") ? "selected" : ""; ?>>(GMT) Western Europe Time, London, Lisbon, Casablanca</option>
								<option value="1.0"<?php echo (@$coockie == "+01:00") ? "selected" : ""; ?>>(GMT +1:00 hour) Brussels, Copenhagen, Madrid, Paris</option>
								<option value="2.0"<?php echo (@$coockie == "+02:00") ? "selected" : ""; ?>>(GMT +2:00) Kaliningrad, South Africa</option>
								<option value="3.0"<?php echo (@$coockie == "+03:00") ? "selected" : ""; ?>>(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg</option>
								<option value="3.5"<?php echo (@$coockie == "+03:30") ? "selected" : ""; ?>>(GMT +3:30) Tehran</option>
								<option value="4.0"<?php echo (@$coockie == "+04:00") ? "selected" : ""; ?>>(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi</option>				
								<option value="4.5"<?php echo (@$coockie == "+04:30") ? "selected" : ""; ?>>(GMT +4:30) Kabul</option>
								<option value="5.0"<?php echo (@$coockie == "+05:00") ? "selected" : ""; ?>>(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent</option>
								<option value="5.5"<?php echo (@$coockie == "+05:30") ? "selected" : ""; ?>>(GMT +5:30) Bombay, Calcutta, Madras, New Delhi</option>
								<option value="5.75"<?php echo (@$coockie == "+05:45") ? "selected" : ""; ?>>(GMT +5:45) Kathmandu</option>
								<option value="6.0"<?php echo (@$coockie == "+06:00") ? "selected" : ""; ?>>(GMT +6:00) Almaty, Dhaka, Colombo</option>
								<option value="7.0"<?php echo (@$coockie == "+07:00") ? "selected" : ""; ?>>(GMT +7:00) Bangkok, Hanoi, Jakarta</option>
								<option value="8.0"<?php echo (@$coockie == "+08:00") ? "selected" : ""; ?>>(GMT +8:00) Beijing, Perth, Singapore, Hong Kong</option>
								<option value="9.0"<?php echo (@$coockie == "+09:00") ? "selected" : ""; ?>>(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk</option>
								<option value="9.5"<?php echo (@$coockie == "+09:30") ? "selected" : ""; ?>>(GMT +9:30) Adelaide, Darwin</option>
								<option value="10.0"<?php echo (@$coockie == "+10:00") ? "selected" : ""; ?>>(GMT +10:00) Eastern Australia, Guam, Vladivostok</option>
								<option value="11.0"<?php echo (@$coockie == "+11:00") ? "selected" : ""; ?>>(GMT +11:00) Magadan, Solomon Islands, New Caledonia</option>
								<option value="12.0"<?php echo (@$coockie == "+12:00") ? "selected" : ""; ?>>(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka</option>
							</select>
						</form>
						<br />
					</h3>				    
			  </div>

	<div id="content">
		<form name="searchfilter" action=<?php echo $pageName; ?> method="post">
			Page &nbsp;&nbsp;&nbsp;&nbsp;: 
			<select name="page_id" id="page_id" class="field" style="width:650px;">

				<option value="">All</option>
				<?php
				foreach ($searhCondP as $aData) {
						$selectedP = ($aData["id"] == @$_POST['page_id']) ? "selected" : "";
						echo "<option " . $selectedP . "  value='" . $aData["id"] . "'>" . $aData["page_name"] . "</option>";
						}
					
				?>
			</select>
			<br><br>
			Country : 	
			<select name="country_name" id="country_name" class="field" style='width: 200px;' id="country_name" >

				<option value="All">All</option>
				
				<?php
				foreach ($analyticsDataC as $aData)
					{

						$selectedC = ($aData["country"] == @$_POST['country_name']) ? "selected" : "";

						echo "<option " . $selectedC . " value='" . $aData["country"] . "'>" . $aData["country"] . "</option>";
					}
				?>

			</select> 
			
			City  : 
			

			<select name="city_name" id="city_name" class="field" style='width: 200px;' >

				<option value="">All</option>

				<?php
					foreach ($analyticsDataCi as $aData) {

							$selectedC = ($aData["city"] == @$_POST['city_name']) ? "selected" : "";

							echo "<option " . $selectedC . " value='" . $aData["city"] . "'>" . $aData["city"] . "</option>";
						}
				?>

			</select> 
			<?php
			
			?>

			IP Address : 

			<select name="IpAddress" id="IpAddress" class="field">

				<option value="">All</option>

				<?php
				foreach ($analyticsDataip as $aData) {

						$selectedC = ($aData["ip_address"] == @$_POST['IpAddress']) ? "selected" : "";

						echo "<option " . $selectedC . " value='" . $aData["ip_address"] . "'>" . $aData["ip_address"] . "</option>";
					}
				?>

			</select> 
			<br><br><br>				
			<?php
			$orderby = "ASC";
			if (@$_POST['order'] != "") {
				$orderby = ($_POST['order'] == "Descending") ? "DESC" : "ASC";
			}
			
			$sqlC = "SELECT distinct(vi.ip_address) as ip_address FROM visitors_info as vi WHERE vi.geo_info_status = 1" . $searhCondIP . $friendlyIpsCond;
			try {
				$stmtC = $dbcon->prepare($sqlC, array(PDO::ATTR_CURSOR => PDO::CURSOR_SCROLL));
				$stmtC->execute();
			} catch (PDOException $e) {
				print $e->getMessage();
			}
			?>

			Order Type : <br>
			<div id="itemRows1" style="float:left">

				<?php
				$oArray = array("DATE(vi.datetime)" => "Date", "vi.country" => "Country", "vi.city" => "City", "vi.ip_address" => "IPAddress", "p.page_name" => "Page");
				$oArray1 = array("DESC" => "Des", "ASC" => "Asc");
				if (count(@$_POST['order_type']) > 0) 
				{
					$oC = 0;
					foreach(@$_POST['order_type'] as $value)
					{
						echo '
						<div id="rowNum1'.$oC.'" style="float:left;">
							<span>
								<select name="order_type[]" id="order_type" class="field"> onchange="this.form.submit()"';							
								foreach ($oArray as $order => $val) 
								{
									$selectedO = ($order == $value) ? "selected" : "";
									echo '<option ' . $selectedO . ' value="' . $order . '">' . $val . '</option>';
								}
								echo '		</select><select name="order_by[]" id="order_by" class="field" onchange="this.form.submit()">';
								foreach ($oArray1 as $order1 => $val1) 
								{
									$selectedO1 = ($order1 == $_POST['order_by'][$oC]) ? "selected" : "";
									echo '<option ' . $selectedO1 . ' value="' . $order1 . '">' . $val1 . '</option>';
								}
								echo '</select>
							</span>
							<span>';
									
									if($oC == 0)
									{
										echo '<span onclick="addRow1(this.form);" class="designadd">Add</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
									}
									else
									{
										echo '<span onclick="removeRow1('.$oC.');" class="designremove">Remove</span>';
									}
									echo '
							</span> 
						</div>';
						$oC++;
					}
				}
				else
				{
					echo '<div id="rowNum10" style="float:left;">
							<span>
								<select name="order_type[]" id="order_type" class="field">';							
							foreach ($oArray as $order => $val) 
							{
								echo '<option ' . @$selectedO . ' value="' . $order . '">' . $val . '</option>';
							}
							echo '		</select><select name="order_by[]" id="order_by" class="field">';
							foreach ($oArray1 as $order1 => $val1) 
							{
								@$selectedO1 = ($order1 == $value1) ? "selected" : "";
								echo '<option ' . $selectedO1 . ' value="' . $order1 . '">' . $val1 . '</option>';
							}
							echo '</select></span><span><span onclick="addRow1(this.form);" class="designadd">Add</span></span> 
						</div>';
				}
				$final_query = '';
				$selectedO = "DESC";
				?>
			</div>
			<br>
			<div class="tejago">
			<span style="float:right;margin-right:700px;"><input type="submit" name="sbtn12" value="GO"></span>
			</div>
		</form>	
	</div>
	<?php 
	$orderField = "";

	$i = 0;
	if (count(@$_POST['order_type']) > 0)
	{
	
		foreach(@$_POST['order_type'] as $value)
		{
	
		$orderField .= $value." ".$_POST['order_by'][$i] .",";
				
		$i=$i+1;					
		}
		//echo $orderField;
		$orderField = substr($orderField,0,(strlen($orderField) - 1));
	
	}
	else
	{
		$orderField = 'vi.datetime DESC';
	}			
	
	$friendlyIps = getFriendlyIP();

	?>
		

<script>
 
$('#country_name').change(createSelect2);

function createSelect2(){
    var option = $(this).find(':selected').val();
	//alert(option);
    dataString = "option="+option;
    if(option != '')
    {
        $.ajax({
            type     : 'GET',
            //url      : 'http://www.mitilini-trans.gr/demo/test.php',
			url      : 'get_cities_ajax.php',
            data     : dataString,
            dataType : 'JSON',
            cache: false,
            success  : function(data) {            
                //var output = '<option value="">Select Sth</option>';
				var output = '<option value="">All</option>';
                $.each(data.data, function(i,s){
						var newOption = s;
						var splitArray = newOption.split(":::");
                    output += '<option value="' + splitArray[0] + '">' + splitArray[1] + '</option>';
                });

                $('#city_name').empty().append(output);
            },
            error: function(){
                console.log("Ajax failed");
            }
        }); 
    }
    else
    {
        console.log("You have to select at least sth");
    }
}
</script>
